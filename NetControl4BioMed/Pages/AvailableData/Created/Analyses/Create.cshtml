@page
@model CreateModel
@using NetControl4BioMed.Data.Enumerations
@using NetControl4BioMed.Helpers.Extensions
@{
    ViewData["Title"] = "Create analysis";
}

<form method="post" class="text-justify">
    <div asp-validation-summary="ModelOnly" class="alert alert-danger text-wrap text-justify"></div>
    <div class="card mb-3">
        <div class="card-header font-weight-bold">
            <div class="d-flex flex-column flex-lg-row-reverse justify-content-center align-items-center justify-content-lg-between">
                <div>
                    <span><i class="fas fa-info-circle"></i></span>
                </div>
                <div>
                    <span>Details</span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="alert alert-info text-justify text-wrap">
                <span><i class="fas fa-info-circle"></i></span>
                <span>Input here the general details of the new analysis.</span>
            </div>
            <div class="form-group">
                <label asp-for="Input.Name" class="font-weight-bold">Name</label>
                <input asp-for="Input.Name" class="form-control" />
                <span asp-description-for="Input.Name" class="text-muted small">The name of the new analysis.</span>
                <span asp-validation-for="Input.Name" class="text-danger small"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.Description" class="font-weight-bold">Description</label>
                <textarea asp-for="Input.Description" class="form-control"></textarea>
                <span asp-description-for="Input.Description" class="text-muted small">The description of the new analysis.</span>
                <span asp-validation-for="Input.Description" class="text-danger small"></span>
            </div>
            <div class="form-group" hidden="@(User.Identity.IsAuthenticated ? null : "hidden")">
                <label asp-for="Input.IsPublic" class="font-weight-bold">Set the analysis as public?</label>
                <select asp-for="Input.IsPublic" class="custom-select form-control">
                    <option value="false" selected="@(User.Identity.IsAuthenticated ? "selected" : null)">No</option>
                    <option value="true" selected="@(User.Identity.IsAuthenticated ? null : "selected")">Yes</option>
                </select>
                <span asp-description-for="Input.IsPublic" class="text-muted small">The availability of the analysis in the list of public analysis. If public, anyone can access it.</span>
                <span asp-validation-for="Input.IsPublic" class="text-danger small"></span>
            </div>
        </div>
    </div>
    <div class="card mb-3">
        <div class="card-header font-weight-bold">
            <div class="d-flex flex-column flex-lg-row-reverse justify-content-center align-items-center justify-content-lg-between">
                <div>
                    <span><i class="fas fa-share-alt"></i></span>
                </div>
                <div>
                    <span>Network</span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="alert alert-primary text-justify text-wrap">
                <span><i class="fas fa-info-circle"></i></span>
                <span>The analysis will use the network "<a asp-page="/AvailableData/Created/Networks/Details/Index" asp-route-id="@Model.View.Network.Id" class="alert-link" target="_blank" rel="nofollow noopener noreferrer" title="@Model.View.Network.Name">@Model.View.Network.Name</a>". If you would like to choose a different network, you can navigate to its corresponding page.</span>
                <span>You can find all of the public networks <a asp-page="/PublicData/Networks/Index" class="alert-link" target="_blank" rel="nofollow noopener noreferrer">here</a>.</span>
                @if (User.Identity.IsAuthenticated)
                {
                    <span>You can find all of the networks associated with your account <a asp-page="/PrivateData/Networks/Index" class="alert-link" target="_blank" rel="nofollow noopener noreferrer">here</a>.</span>
                }
            </div>
            <div class="form-group" hidden>
                <label asp-for="Input.NetworkId" class="font-weight-bold">Network ID</label>
                <input asp-for="Input.NetworkId" class="form-control" />
                <span asp-description-for="Input.NetworkId" class="text-muted small">The ID of the network to be used by the new analysis.</span>
                <span asp-validation-for="Input.NetworkId" class="text-danger small"></span>
            </div>
            <a asp-page="/AvailableData/Created/Networks/Details/Index" asp-route-id="@Model.View.Network.Id" class="btn btn-primary btn-block" target="_blank" rel="nofollow noopener noreferrer" title="View network">
                <span><i class="fas fa-share-alt"></i></span>
                <span>View network</span>
            </a>
        </div>
    </div>
    <div class="card mb-3 file-group" data-type="items">
        <div class="card-header font-weight-bold">
            <div class="d-flex flex-column flex-lg-row-reverse justify-content-center align-items-center justify-content-lg-between">
                <div>
                    <span><i class="fas fa-list"></i></span>
                </div>
                <div>
                    <span>Source proteins</span>
                    <span class="badge badge-dark file-group-count">0</span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="alert alert-info text-justify text-wrap">
                <span><i class="fas fa-info-circle"></i></span>
                <span>Input here the identifiers of the source proteins (preferred control inputs) to be used by the new analysis.</span>
                @if (Model.View.HasNetworkDatabases)
                {
                    <span>You can check all of the potential identifiers <a asp-page="/AvailableData/Databases/DatabaseProteinFields/Index" asp-route-filter="IsSearchable" class="alert-link" target="_blank" rel="nofollow noopener noreferrer">here</a>.</span>
                }
            </div>
            <div class="form-group" hidden>
                <label asp-for="Input.SourceProteinData" class="font-weight-bold">Source proteins</label>
                <textarea asp-for="Input.SourceProteinData" class="form-control file-group-input"></textarea>
                <span asp-description-for="Input.SourceProteinData" class="text-muted small">The source proteins to be used by the new analysis, formatted as a JSON string array. This field should not be directly interacted with, the form entries below should be used to edit the data instead.</span>
                <span asp-validation-for="Input.SourceProteinData" class="text-danger small"></span>
            </div>
            <div class="form-group">
                <div class="row align-items-center mb-2">
                    <div class="col-lg-4">
                        <label for="data-textarea-source-protein" class="font-weight-bold mb-0">Source protein identifiers</label>
                    </div>
                    <div class="col-lg-8">
                        <div class="row align-items-center">
                            <div class="col-6 col-form-label-sm text-right">
                                <label for="data-line-separator-source" class="font-weight-normal mb-0">Line separator:</label>
                            </div>
                            <div class="col-6 text-left">
                                <select id="data-line-separator-source" class="custom-select custom-select-sm file-group-separator file-group-line-separator">
                                    <option value=",">comma (",")</option>
                                    <option value=";">semicolon (";")</option>
                                    <option value="\t">tab ("\t")</option>
                                    <option value="\s">space (" ")</option>
                                    <option value="\n" selected>new line ("\n")</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <textarea id="data-textarea-source-protein" class="form-control file-group-text mb-2"></textarea>
                <div class="custom-file">
                    <input type="file" class="custom-file-input file-group-file-upload" />
                    <label class="custom-file-label file-group-file-label">Choose file</label>
                </div>
                <span class="text-muted small">The source proteins to be used by the new analysis. The data can also be uploaded from a file; in this case, the file content will appear, unchanged, above.</span>
            </div>
        </div>
    </div>
    <div class="card mb-3 table-group" hidden="@(Model.View.HasNetworkDatabases && Model.View.SourceProteinCollections.Any() ? null : "hidden")">
        <div class="card-header font-weight-bold">
            <div class="d-flex flex-column flex-lg-row-reverse justify-content-center align-items-center justify-content-lg-between">
                <div>
                    <span><i class="fas fa-folder"></i></span>
                </div>
                <div>
                    <span>Additional source proteins</span>
                    <span class="badge badge-dark table-group-count">0</span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="alert alert-info text-justify text-wrap">
                <span><i class="fas fa-info-circle"></i></span>
                <span>Select here the source collections to be used by the new network. This can be done either in addition to, or instead of the source proteins above. You can check all of the available drug-target data <a asp-page="/AvailableData/Data/ProteinCollections/Index" asp-route-filter="IsSource" class="alert-link" target="_blank" rel="nofollow noopener noreferrer">here</a>.</span>
            </div>
            <div class="form-group" hidden>
                <label asp-for="Input.SourceProteinCollectionData" class="font-weight-bold">Source protein collection IDs</label>
                <textarea asp-for="Input.SourceProteinCollectionData" class="form-control table-group-input"></textarea>
                <span asp-description-for="Input.SourceProteinCollectionData" class="text-muted small">The IDs of the source protein collections to be used by the new network, formatted as a JSON string array. This field should not be directly interacted with, the form entries below should be used to edit the data instead.</span>
                <span asp-validation-for="Input.SourceProteinCollectionData" class="text-danger small"></span>
            </div>
            <div class="form-group">
                <table class="table table-hover table-striped table-bordered table-group-datatable" data-order="[[1]]">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-center text-break" data-orderable="false" data-searchable="false" data-name="index">
                                <span></span>
                            </th>
                            <th class="text-left text-break">
                                <span>Collection</span>
                            </th>
                            <th class="text-center text-break" data-orderable="false" data-searchable="false">
                                <span>Links</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sourceProteinCollection in Model.View.SourceProteinCollections)
                        {
                            <tr class="table-group-row" data-id="@sourceProteinCollection.Id">
                                <td class="text-center text-break">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" id="checkbox-source-protein-collection-@sourceProteinCollection.Id" class="custom-control-input table-group-row-checkbox" title="Select" />
                                        <label for="checkbox-source-protein-collection-@sourceProteinCollection.Id" class="custom-control-label"></label>
                                    </div>
                                    <span></span>
                                </td>
                                <td class="text-left text-break">
                                    <a asp-page="/AvailableData/Data/ProteinCollections/Details" asp-route-id="@sourceProteinCollection.Id" target="_blank" rel="nofollow noopener noreferrer" title="@sourceProteinCollection.Name">@sourceProteinCollection.Name</a>
                                </td>
                                <td class="text-center text-break">
                                    <a asp-page="/AvailableData/Data/ProteinCollections/Details" asp-route-id="@sourceProteinCollection.Id" target="_blank" rel="nofollow noopener noreferrer" title="Details">
                                        <span>Details</span>
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="card mb-3 file-group" data-type="items">
        <div class="card-header font-weight-bold">
            <div class="d-flex flex-column flex-lg-row-reverse justify-content-center align-items-center justify-content-lg-between">
                <div>
                    <span><i class="fas fa-list"></i></span>
                </div>
                <div>
                    <span>Target proteins</span>
                    <span class="badge badge-dark file-group-count">0</span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="alert alert-info text-justify text-wrap">
                <span><i class="fas fa-info-circle"></i></span>
                <span>Input here the identifiers of the target proteins to be used by the new analysis.</span>
                @if (Model.View.HasNetworkDatabases)
                {
                    <span>You can check all of the potential identifiers <a asp-page="/AvailableData/Databases/DatabaseProteinFields/Index" asp-route-filter="IsSearchable" class="alert-link" target="_blank" rel="nofollow noopener noreferrer">here</a>.</span>
                }
            </div>
            <div class="form-group" hidden>
                <label asp-for="Input.TargetProteinData" class="font-weight-bold">Target proteins</label>
                <textarea asp-for="Input.TargetProteinData" class="form-control file-group-input"></textarea>
                <span asp-description-for="Input.TargetProteinData" class="text-muted small">The target proteins to be used by the new analysis, formatted as a JSON string array. This field should not be directly interacted with, the form entries below should be used to edit the data instead.</span>
                <span asp-validation-for="Input.TargetProteinData" class="text-danger small"></span>
            </div>
            <div class="form-group">
                <div class="row align-items-center mb-2">
                    <div class="col-lg-4">
                        <label for="data-textarea-target-protein" class="font-weight-bold mb-0">Target protein identifiers</label>
                    </div>
                    <div class="col-lg-8">
                        <div class="row align-items-center">
                            <div class="col-6 col-form-label-sm text-right">
                                <label for="data-line-separator-target" class="font-weight-normal mb-0">Line separator:</label>
                            </div>
                            <div class="col-6 text-left">
                                <select id="data-line-separator-target" class="custom-select custom-select-sm file-group-separator file-group-line-separator">
                                    <option value=",">comma (",")</option>
                                    <option value=";">semicolon (";")</option>
                                    <option value="\t">tab ("\t")</option>
                                    <option value="\s">space (" ")</option>
                                    <option value="\n" selected>new line ("\n")</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <textarea id="data-textarea-target-protein" class="form-control file-group-text mb-2"></textarea>
                <div class="custom-file">
                    <input type="file" class="custom-file-input file-group-file-upload" />
                    <label class="custom-file-label file-group-file-label">Choose file</label>
                </div>
                <span class="text-muted small">The target proteins to be used by the new analysis. The data can also be uploaded from a file; in this case, the file content will appear, unchanged, above.</span>
            </div>
        </div>
    </div>
    <div class="card mb-3 table-group" hidden="@(Model.View.HasNetworkDatabases && Model.View.TargetProteinCollections.Any() ? null : "hidden")">
        <div class="card-header font-weight-bold">
            <div class="d-flex flex-column flex-lg-row-reverse justify-content-center align-items-center justify-content-lg-between">
                <div>
                    <span><i class="fas fa-folder"></i></span>
                </div>
                <div>
                    <span>Additional target proteins</span>
                    <span class="badge badge-dark table-group-count">0</span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="alert alert-info text-justify text-wrap">
                <span><i class="fas fa-info-circle"></i></span>
                <span>Select here the target collections to be used by the new network. This can be done either in addition to, or instead of the target proteins above. You can check all of the available cell-line data <a asp-page="/AvailableData/Data/ProteinCollections/Index" asp-route-filter="IsTarget" class="alert-link" target="_blank" rel="nofollow noopener noreferrer">here</a>.</span>
            </div>
            <div class="form-group" hidden>
                <label asp-for="Input.TargetProteinCollectionData" class="font-weight-bold">Target protein collection IDs</label>
                <textarea asp-for="Input.TargetProteinCollectionData" class="form-control table-group-input"></textarea>
                <span asp-description-for="Input.TargetProteinCollectionData" class="text-muted small">The IDs of the target protein collections to be used by the new network, formatted as a JSON string array. This field should not be directly interacted with, the form entries below should be used to edit the data instead.</span>
                <span asp-validation-for="Input.TargetProteinCollectionData" class="text-danger small"></span>
            </div>
            <div class="form-group">
                <table class="table table-hover table-striped table-bordered table-group-datatable" data-order="[[1]]">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-center text-break" data-orderable="false" data-searchable="false" data-name="index">
                                <span></span>
                            </th>
                            <th class="text-left text-break">
                                <span>Collection</span>
                            </th>
                            <th class="text-center text-break" data-orderable="false" data-searchable="false">
                                <span>Links</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var targetProteinCollection in Model.View.TargetProteinCollections)
                        {
                            <tr class="table-group-row" data-id="@targetProteinCollection.Id">
                                <td class="text-center text-break">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" id="checkbox-target-protein-collection-@targetProteinCollection.Id" class="custom-control-input table-group-row-checkbox" title="Select" />
                                        <label for="checkbox-target-protein-collection-@targetProteinCollection.Id" class="custom-control-label"></label>
                                    </div>
                                    <span></span>
                                </td>
                                <td class="text-left text-break">
                                    <a asp-page="/AvailableData/Data/ProteinCollections/Details" asp-route-id="@targetProteinCollection.Id" target="_blank" rel="nofollow noopener noreferrer" title="@targetProteinCollection.Name">@targetProteinCollection.Name</a>
                                </td>
                                <td class="text-center text-break">
                                    <a asp-page="/AvailableData/Data/ProteinCollections/Details" asp-route-id="@targetProteinCollection.Id" target="_blank" rel="nofollow noopener noreferrer" title="Details">
                                        <span>Details</span>
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="card mb-3 parameter-group" data-type="items">
        <div class="card-header font-weight-bold">
            <div class="d-flex flex-column flex-lg-row-reverse justify-content-center align-items-center justify-content-lg-between">
                <div>
                    <span><i class="fas fa-code"></i></span>
                </div>
                <div>
                    <span>Parameters</span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="alert alert-info text-justify text-wrap">
                <span><i class="fas fa-info-circle"></i></span>
                <span>Input here the parameters of the algorithm to be used by the new analysis.</span>
            </div>
            <div class="form-group">
                <label asp-for="Input.Algorithm" class="font-weight-bold">Algorithm</label>
                <select asp-for="Input.Algorithm" class="custom-select parameter-group-select">
                    @foreach (var item in Enum.GetValues(typeof(AnalysisAlgorithm)).Cast<AnalysisAlgorithm>())
                    {
                        <option value="@item.ToString()" title="@item.GetDisplayDescription()">@item.GetDisplayName()</option>
                    }
                </select>
                <span asp-description-for="Input.Algorithm" class="text-muted small">The algorithm to be used by the new analysis.</span>
                <span asp-validation-for="Input.Algorithm" class="text-danger small"></span>
            </div>
            <div class="row">
                <div class="col-lg-6 order-1 order-lg-1 align-self-center">
                    <label asp-for="Input.MaximumIterations" class="font-weight-bold">Maximum iterations</label>
                </div>
                <div class="col-lg-6 order-1 order-lg-2">
                    <input asp-for="Input.MaximumIterations" class="form-control" />
                </div>
                <div class="col-lg-6 order-1 order-lg-3 mb-3">
                    <span asp-description-for="Input.MaximumIterations" class="text-muted small">The maximum number of iterations for which the analysis to run.</span>
                    <span asp-validation-for="Input.MaximumIterations" class="text-danger small"></span>
                </div>
                <div class="col-lg-6 order-2 order-lg-1 align-self-center">
                    <label asp-for="Input.MaximumIterationsWithoutImprovement" class="font-weight-bold">Maximum iterations without improvement</label>
                </div>
                <div class="col-lg-6 order-2 order-lg-2">
                    <input asp-for="Input.MaximumIterationsWithoutImprovement" class="form-control" />
                </div>
                <div class="col-lg-6 order-2 order-lg-3 mb-3">
                    <span asp-description-for="Input.MaximumIterationsWithoutImprovement" class="text-muted small">The maximum number of iterations without improvement in the size of the best solution for which the analysis to run.</span>
                    <span asp-validation-for="Input.MaximumIterationsWithoutImprovement" class="text-danger small"></span>
                </div>
            </div>
            <div class="form-group">
                <label asp-for="Input.Parameters" class="font-weight-bold">Parameters</label>
                <textarea asp-for="Input.Parameters" class="form-control parameter-group-input"></textarea>
                <span asp-description-for="Input.Parameters" class="text-muted small">The parameters of the algorithms to be used by the new analysis, formatted as a JSON object. This field should not be directly interacted with, the form entries below should be used to edit the data instead.</span>
                <span asp-validation-for="Input.Parameters" class="text-danger small"></span>
            </div>
            <div class="parameter-group-set" data-algorithm="@AnalysisAlgorithm.Greedy.ToString()">

            </div>
            <div class="parameter-group-set" data-algorithm="@AnalysisAlgorithm.Genetic.ToString()">

            </div>
        </div>
    </div>
    <div class="form-group" hidden>
        <label asp-for="Input.ReCaptchaToken" class="font-weight-bold">reCaptcha token</label>
        <input asp-for="Input.ReCaptchaToken" class="form-control recaptcha-input" />
        <span asp-description-for="Input.ReCaptchaToken" class="text-muted small">The reCaptcha token corresponding to the current request.</span>
        <span asp-validation-for="Input.ReCaptchaToken" class="text-danger small"></span>
    </div>
    <button type="submit" class="btn btn-block btn-success" title="Create">
        <span><i class="fas fa-plus"></i></span>
        <span>Create</span>
    </button>
</form>

@section Scripts {
    <partial name="_ScriptsValidationPartial" />
    <partial name="_ScriptsReCaptchaPartial" />
}
